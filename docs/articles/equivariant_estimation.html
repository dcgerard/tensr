<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equivariant Estimation of Kronecker Structured Covariance Matrices • tensr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Equivariant Estimation of Kronecker Structured Covariance Matrices">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tensr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/equivariant_estimation.html">Equivariant Estimation of Kronecker Structured Covariance Matrices</a>
    </li>
    <li>
      <a href="../articles/maximum_likelihood.html">Likelihood Inference in Kronecker Structured Covariance Models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Equivariant Estimation of Kronecker Structured Covariance Matrices</h1>
                        <h4 class="author">David Gerard</h4>
            
            <h4 class="date">2018-08-15</h4>
      
      
      <div class="hidden name"><code>equivariant_estimation.Rmd</code></div>

    </div>

    
    
<div id="abstract-" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract-" class="anchor"></a>Abstract.</h1>
<p>This Vignette demonstrates using the equivariant estimation procedures in the <code>R</code> package <code>tensr</code>. We will simulate some data then explore the performance differences between the uniformly minimum risk equivariant estimator (UMREE), the maximum likelihood estimator (MLE), multiway Takemura’s estimator, and a moment based estimator. Then we will demonstrate extracting posterior summaries. Finally, we will demonstrate the equivariance of the Bayes rule.</p>
</div>
<div id="comparison-of-methods-" class="section level1">
<h1 class="hasAnchor">
<a href="#comparison-of-methods-" class="anchor"></a>Comparison of Methods.</h1>
<p>First, we generate a data array <span class="math inline">\(X\)</span> of dimension <span class="math inline">\(10 \times 10 \times 10\)</span>. Each mode of <span class="math inline">\(X\)</span> will have an AR-1(0.7) covariance structure. That is <span class="math inline">\(\text{cov}(\text{vec}(X)) = \Sigma_3 \otimes \Sigma_2 \otimes \Sigma_1\)</span>, where <span class="math inline">\(\text{vec}(\cdot)\)</span> is the same think as <code>c</code> in <code>R</code> and just “vectorizes” <span class="math inline">\(X\)</span>, and “<span class="math inline">\(\otimes\)</span>” is the Kronecker product. Hence <span class="math inline">\(\Sigma_{i,j} = 0.7^{|i - j|}\)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">360</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)  <span class="co">#Dimension of tensor.</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">n &lt;-<span class="st"> </span><span class="kw">length</span>(p) <span class="co">#Order of the tensor.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">cov_list &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">normalized_cov_list &lt;-<span class="st"> </span><span class="kw">list</span>()  <span class="co">#Same as cov_list, but scaled down to determinant 1.</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">sig2_total &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">rho &lt;-<span class="st"> </span><span class="fl">0.7</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="cf">for</span> (mode_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    cov_list[[mode_index]] &lt;-</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="st">      </span>rho <span class="op">^</span><span class="st"> </span><span class="kw">abs</span>(<span class="kw">outer</span>(<span class="dv">1</span><span class="op">:</span>p[mode_index], <span class="dv">1</span><span class="op">:</span>p[mode_index], <span class="st">"-"</span>))</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    scale_cov &lt;-<span class="st"> </span><span class="kw">det</span>(cov_list[[mode_index]]) <span class="op">^</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>p[mode_index])</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    sig2_total &lt;-<span class="st"> </span>sig2_total <span class="op">*</span><span class="st"> </span>scale_cov</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">    normalized_cov_list[[mode_index]] &lt;-<span class="st"> </span>cov_list[[mode_index]] <span class="op">/</span><span class="st"> </span>scale_cov</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">}</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">##Generate data with above covariance structure.</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">X &lt;-<span class="st"> </span><span class="kw"><a href="../reference/atrans.html">atrans</a></span>(<span class="kw">array</span>(<span class="kw">rnorm</span>(<span class="kw">prod</span>(p)), <span class="dt">dim =</span> p), <span class="kw">lapply</span>(cov_list, mhalf))</a></code></pre></div>
<p>To get the UMREE, we first apply the function <code>equi_mcmc</code>. This will give us posterior draws of the inverse of the lower-triangular Cholesky square root of each component covariance matrix. This is with respect to using the right Haar measure over a product group of lower-triangular matrices as our prior. Using the output from <code>equi_mcmc</code>, we apply the function <code>get_equi_bayes</code> to obtain the Bayes rule under multiway Stein’s loss.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">mcmc_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equi_mcmc.html">equi_mcmc</a></span>(X, <span class="dv">1000</span>) </a>
<a class="sourceLine" id="cb2-2" data-line-number="2">bayes_rule &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_equi_bayes.html">get_equi_bayes</a></span>(mcmc_out<span class="op">$</span>Phi_inv, mcmc_out<span class="op">$</span>sigma)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">cov_umree &lt;-<span class="st"> </span>bayes_rule<span class="op">$</span>Sig_hat</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#Estimate of the "standard deviation" form for the total variation parameter.</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">sig_umree &lt;-<span class="st"> </span>bayes_rule<span class="op">$</span>b </a></code></pre></div>
<p>We can improve on the UMREE by calculating UMREEs for different rotations of the data array, then “average” these UMREEs. The more averagings the better in terms of statistical risk. This estimator is called multiway Takemura’s estimator.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">tak_est &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multiway_takemura.html">multiway_takemura</a></span>(X, <span class="dt">ortho_max =</span> <span class="dv">3</span>, <span class="dt">print_mcmc =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Number of averagings =  1 
## Number of averagings =  2 
## Number of averagings =  3</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">cov_takemura &lt;-<span class="st"> </span>tak_est<span class="op">$</span>B</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">sig_takemura &lt;-<span class="st"> </span>tak_est<span class="op">$</span>b</a></code></pre></div>
<p>We use <code>holq</code> to obtain the MLE for comparison. The output of <code>holq</code> is fed into <code>mle_from_holq</code> to obtain the MLEs of each component covariance matrix.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">holq_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/holq.html">holq</a></span>(X, <span class="dt">print_diff =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">mle_x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mle_from_holq.html">mle_from_holq</a></span>(holq_x)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">cov_mle &lt;-<span class="st"> </span>mle_x<span class="op">$</span>cov_mle</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#The "standard deviation" form for the total variation parameter.</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">sig_mle &lt;-<span class="st"> </span>mle_x<span class="op">$</span>sig_mle </a></code></pre></div>
<p>We also obtain a “moment-based” estimator for comparison. These are just the sample covariance matrices of each mode, scaled down to have unit determinant. The estimate of the total variation parameter is the MLE conditional on the component covariance matrices. This is not implemented in <code>tensr</code> because it performs poorly.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">get_moment &lt;-<span class="st"> </span><span class="cf">function</span>(X) {</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">    p &lt;-<span class="st"> </span><span class="kw">dim</span>(X)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    n &lt;-<span class="st"> </span><span class="kw">length</span>(p)</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    cov_moment &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    cov_chol_inv &lt;-<span class="st"> </span><span class="kw">list</span>()  <span class="co">## used for getting scale est</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="cf">for</span> (mode_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">        cov_temp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mat.html">mat</a></span>(X, mode_index) <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(<span class="kw"><a href="../reference/mat.html">mat</a></span>(X, mode_index))</a>
<a class="sourceLine" id="cb7-8" data-line-number="8">        cov_moment[[mode_index]] &lt;-<span class="st"> </span>cov_temp<span class="op">/</span>(<span class="kw">det</span>(cov_temp)<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>p[mode_index]))</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">        cov_chol_inv[[mode_index]] &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">backsolve</span>(<span class="kw">chol</span>(cov_moment[[mode_index]]), </a>
<a class="sourceLine" id="cb7-10" data-line-number="10">            <span class="kw">diag</span>(p[mode_index])))</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    }</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">    sig_moment &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">sum</span>(<span class="kw"><a href="../reference/atrans.html">atrans</a></span>(X, cov_chol_inv)<span class="op">^</span><span class="dv">2</span>)<span class="op">/</span><span class="kw">prod</span>(p))</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">cov_moment =</span> cov_moment, <span class="dt">sig_moment =</span> sig_moment))</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">moment_x &lt;-<span class="st"> </span><span class="kw">get_moment</span>(X)</a>
<a class="sourceLine" id="cb7-16" data-line-number="16">cov_moment &lt;-<span class="st"> </span>moment_x<span class="op">$</span>cov_moment</a>
<a class="sourceLine" id="cb7-17" data-line-number="17">sig_moment &lt;-<span class="st"> </span>moment_x<span class="op">$</span>sig_moment</a></code></pre></div>
<p>We can now compare the multiway Stein’s losses for each of the estimators using <code>multi_stein_loss_cov</code>. The risk performance should be, in decreasing order of performance, multiway Takemura’s estimator, UMREE, MLE, moment. Of course, for any individual realization, the loss ordering may be different.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">umree_loss &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span>(cov_umree, normalized_cov_list, sig_umree, <span class="kw">sqrt</span>(sig2_total))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">tak_loss &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span>(cov_takemura, normalized_cov_list, sig_takemura, </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="kw">sqrt</span>(sig2_total))</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">mle_loss &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span>(cov_mle, normalized_cov_list, sig_mle, <span class="kw">sqrt</span>(sig2_total))</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">moment_loss &lt;-<span class="st"> </span><span class="kw"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span>(cov_moment, normalized_cov_list, sig_moment, </a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="kw">sqrt</span>(sig2_total))</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw">cat</span>(</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    <span class="st">"Multiway Takemura's Loss:"</span>, <span class="kw">round</span>(tak_loss), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">    <span class="st">"             UMREE Loss:"</span>, <span class="kw">round</span>(umree_loss), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,  </a>
<a class="sourceLine" id="cb8-11" data-line-number="11">    <span class="st">"               MLE Loss:"</span>, <span class="kw">round</span>(mle_loss), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">    <span class="st">"            Moment Loss:"</span>, <span class="kw">round</span>(moment_loss), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">   )</a></code></pre></div>
<pre><code>## Multiway Takemura's Loss: 206 
##               UMREE Loss: 209 
##                 MLE Loss: 235 
##              Moment Loss: 3631</code></pre>
</div>
<div id="posterior-summaries" class="section level1">
<h1 class="hasAnchor">
<a href="#posterior-summaries" class="anchor"></a>Posterior Summaries</h1>
<p>You can also get the samples from the posterior if you want to perform a fully Bayesian analysis. Just insert the output of <code>equi_bayes</code> into <code>convert_cov</code> to get these posterior samples.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">cov_post &lt;-<span class="st"> </span><span class="kw"><a href="../reference/convert_cov.html">convert_cov</a></span>(mcmc_out)   </a></code></pre></div>
<p><code>cov_post[[2]]</code> contains the posterior samples of the total variation parameter. <code>cov_post[[1]][[i]][,,j]</code> contains the <span class="math inline">\(j\)</span>th posterior sample of the <span class="math inline">\(i\)</span>th component covariance matrix. Here are some trace plots of the posterior samples.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">cex.axis =</span> <span class="dv">1</span>, <span class="dt">cex.lab =</span> <span class="dv">1</span>, <span class="dt">cex.axis =</span> <span class="dv">1</span>, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.4</span>,<span class="fl">2.6</span>,<span class="dv">2</span>,<span class="fl">0.2</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>,<span class="fl">0.5</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">## trace plot of total variation parameter</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">plot</span>(cov_post[[<span class="dv">2</span>]], <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(sigma<span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">"Iteration"</span>, <span class="dt">main =</span> <span class="st">"Trace Plot"</span>)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw">abline</span>(<span class="dt">h =</span> sig2_total, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="st">"True Parameter"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">bty =</span> <span class="st">"n"</span>)</a></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">## some more trace plots</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">random_trace &lt;-<span class="st"> </span><span class="cf">function</span>(cov_post, true_cov, p) {</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">    n &lt;-<span class="st"> </span><span class="kw">length</span>(p)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">    mode_look &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>n, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">    x_look &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>p[mode_look], <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">    y_look &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>p[mode_look], <span class="dt">size =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">    <span class="kw">plot</span>(cov_post[[<span class="dv">1</span>]][[mode_look]][x_look, y_look, ], <span class="dt">type =</span> <span class="st">"l"</span>,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">         <span class="dt">xlab =</span> <span class="st">"Iteration"</span>, </a>
<a class="sourceLine" id="cb12-9" data-line-number="9">         <span class="dt">ylab =</span> <span class="kw">bquote</span>(Sigma[.(mode_look)][<span class="st">"["</span>][.(x_look)][<span class="st">","</span>][.(y_look)][<span class="st">"]"</span>]), </a>
<a class="sourceLine" id="cb12-10" data-line-number="10">         <span class="dt">main =</span> <span class="st">"Traceplot"</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">    <span class="kw">abline</span>(<span class="dt">h =</span> true_cov[[mode_look]][x_look, y_look], <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">    <span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="st">"True Parameter"</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">bty =</span> <span class="st">"n"</span>)</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb12-14" data-line-number="14"></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="cf">for</span>(index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">    <span class="kw">random_trace</span>(cov_post, normalized_cov_list, p)</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">}</a></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-3.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-4.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-5.png" width="700"></p>
<p>Here are the 95% posterior credible intervals of the covariance parameters, sorted in lexicographical ordering of the row and column indices.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">cex.axis =</span> <span class="dv">1</span>, <span class="dt">cex.lab =</span> <span class="dv">1</span>, <span class="dt">cex.axis =</span> <span class="dv">1</span>, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.4</span>,<span class="fl">2.6</span>,<span class="dv">2</span>,<span class="fl">0.2</span>), <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="fl">1.5</span>,<span class="fl">0.5</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">quantile_list &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="cf">for</span> (mode_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    quantile_list[[mode_index]] &lt;-<span class="st"> </span><span class="kw">apply</span>(cov_post[[<span class="dv">1</span>]][[mode_index]], <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), quantile, </a>
<a class="sourceLine" id="cb13-5" data-line-number="5">        <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="kw">par</span>(<span class="dt">cex.main =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="cf">for</span> (mode_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">    upper_val &lt;-<span class="st"> </span><span class="kw">c</span>(quantile_list[[mode_index]][<span class="dv">3</span>, , ][<span class="kw">lower.tri</span>(<span class="kw">diag</span>(p[mode_index]), </a>
<a class="sourceLine" id="cb13-11" data-line-number="11">        <span class="dt">diag =</span> <span class="ot">TRUE</span>)])</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">    lower_val &lt;-<span class="st"> </span><span class="kw">c</span>(quantile_list[[mode_index]][<span class="dv">1</span>, , ][<span class="kw">lower.tri</span>(<span class="kw">diag</span>(p[mode_index]), </a>
<a class="sourceLine" id="cb13-13" data-line-number="13">        <span class="dt">diag =</span> <span class="ot">TRUE</span>)])</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    median_val &lt;-<span class="st"> </span><span class="kw">c</span>(quantile_list[[mode_index]][<span class="dv">2</span>, , ][<span class="kw">lower.tri</span>(<span class="kw">diag</span>(p[mode_index]), </a>
<a class="sourceLine" id="cb13-15" data-line-number="15">        <span class="dt">diag =</span> <span class="ot">TRUE</span>)])</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">    num_cred &lt;-<span class="st"> </span>p[mode_index] <span class="op">*</span><span class="st"> </span>(p[mode_index] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">    <span class="kw">plot</span>(<span class="kw">c</span>(), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, num_cred), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(lower_val), <span class="kw">max</span>(upper_val)),</a>
<a class="sourceLine" id="cb13-18" data-line-number="18">         <span class="dt">xaxt =</span> <span class="st">"n"</span>, </a>
<a class="sourceLine" id="cb13-19" data-line-number="19">         <span class="dt">xlab =</span> <span class="st">"Parameter"</span>, <span class="dt">ylab =</span> <span class="st">"Value"</span>,</a>
<a class="sourceLine" id="cb13-20" data-line-number="20">         <span class="dt">main =</span> <span class="kw">substitute</span>(z<span class="op">~</span><span class="er">~</span>Sigma[y],</a>
<a class="sourceLine" id="cb13-21" data-line-number="21">                           <span class="kw">list</span>(<span class="dt">z =</span> <span class="st">"Medians and 95% Credible Intervals for"</span>,</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">                                <span class="dt">y =</span> mode_index)))</a>
<a class="sourceLine" id="cb13-23" data-line-number="23">    <span class="kw">arrows</span>(<span class="dv">1</span><span class="op">:</span>num_cred, lower_val, <span class="dv">1</span><span class="op">:</span>num_cred, upper_val, <span class="dt">length =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">    <span class="kw">points</span>(<span class="dv">1</span><span class="op">:</span>num_cred, median_val, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">cex =</span> <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb13-25" data-line-number="25">    <span class="kw">points</span>(<span class="dv">1</span><span class="op">:</span>num_cred, median_val, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">cex =</span> <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb13-26" data-line-number="26">    <span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">    v_at &lt;-<span class="st"> </span><span class="kw">cumsum</span>(p[mode_index]<span class="op">:</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28">    <span class="kw">abline</span>(<span class="dt">v =</span> v_at, <span class="dt">lty =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-29" data-line-number="29">}</a></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-10-1.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-10-2.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-10-3.png" width="700"></p>
</div>
<div id="demonstrate-equivariance" class="section level1">
<h1 class="hasAnchor">
<a href="#demonstrate-equivariance" class="anchor"></a>Demonstrate Equivariance</h1>
<p>We finish with a small example of how the UMREE is equivariant. First, we generate a group element of a product group of lower triangular matrices.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">A_list &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="cf">for</span> (mode_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">    A_temp &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow =</span> p[mode_index], <span class="dt">ncol =</span> p[mode_index])</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    A_temp[<span class="kw">lower.tri</span>(A_temp)] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(p[mode_index] <span class="op">*</span><span class="st"> </span>(p[mode_index] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    <span class="kw">diag</span>(A_temp) &lt;-<span class="st"> </span><span class="kw">rgamma</span>(p[mode_index], <span class="dt">shape =</span> <span class="dv">1</span>, <span class="dt">rate =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    A_temp &lt;-<span class="st"> </span>A_temp<span class="op">/</span><span class="kw">prod</span>(<span class="kw">diag</span>(A_temp))<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>p[mode_index])</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    A_list[[mode_index]] &lt;-<span class="st"> </span>A_temp</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">a_scale &lt;-<span class="st"> </span><span class="dv">10</span></a></code></pre></div>
<p>Now we transform X.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">X_transformed &lt;-<span class="st"> </span>a_scale <span class="op">*</span><span class="st"> </span><span class="kw"><a href="../reference/atrans.html">atrans</a></span>(X, A_list)</a></code></pre></div>
<p>Now we get the UMREEs of the original and the transformed data.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">mcmc_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equi_mcmc.html">equi_mcmc</a></span>(X, <span class="dv">10000</span>) </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">bayes_rule &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_equi_bayes.html">get_equi_bayes</a></span>(mcmc_out<span class="op">$</span>Phi_inv, mcmc_out<span class="op">$</span>sigma)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">cov_x &lt;-<span class="st"> </span>bayes_rule<span class="op">$</span>Sig_hat</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">sig_x &lt;-<span class="st"> </span>bayes_rule<span class="op">$</span>b </a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">mcmc_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/equi_mcmc.html">equi_mcmc</a></span>(X_transformed, <span class="dv">10000</span>) </a>
<a class="sourceLine" id="cb16-7" data-line-number="7">bayes_rule &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_equi_bayes.html">get_equi_bayes</a></span>(mcmc_out<span class="op">$</span>Phi_inv, mcmc_out<span class="op">$</span>sigma)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">cov_x_t &lt;-<span class="st"> </span>bayes_rule<span class="op">$</span>Sig_hat</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">sig_x_t &lt;-<span class="st"> </span>bayes_rule<span class="op">$</span>b</a></code></pre></div>
<p>The UMREE of transformed data should equal the transformed UMREE of original data.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">#These two quantities should be close.</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">"                Total Variation of transformed data:"</span>, sig_x_t, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">    <span class="st">"Transformation of total variation of original data:"</span>, sig_x <span class="op">*</span><span class="st"> </span>a_scale,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a></code></pre></div>
<pre><code>##                 Total Variation of transformed data: 3.906237 
##  Transformation of total variation of original data: 3.905766</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="cf">for</span> (mode_index <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">    <span class="kw">par</span>(<span class="dt">ask =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    x_val &lt;-<span class="st"> </span>cov_x_t[[mode_index]][<span class="kw">lower.tri</span>(<span class="kw">diag</span>(p[mode_index]))]</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    y_val &lt;-<span class="st"> </span>(A_list[[mode_index]] <span class="op">%*%</span><span class="st"> </span>cov_x[[mode_index]] <span class="op">%*%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="st">                </span><span class="kw">t</span>(A_list[[mode_index]]))[<span class="kw">lower.tri</span>(<span class="kw">diag</span>(p[mode_index]))]</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    <span class="kw">plot</span>(x_val, y_val, <span class="dt">xlab =</span> <span class="st">"Transform of UMREE"</span>,</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">         <span class="dt">ylab =</span> <span class="st">"UMREE of Transformed Data"</span>, </a>
<a class="sourceLine" id="cb19-8" data-line-number="8">         <span class="dt">main =</span> <span class="st">"Covariance Estimates"</span>)</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">    <span class="kw">mtext</span>(<span class="st">"(Should Lie on Line if Equivariant)"</span>)</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">    <span class="kw">abline</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">    <span class="kw">par</span>(<span class="dt">ask =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">}</a></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-14-1.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-14-2.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-14-3.png" width="700"></p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p><strong>Gerard, D.</strong>, &amp; Hoff, P. (2015). Equivariant minimax dominators of the MLE in the array normal model. <em>Journal of Multivariate Analysis</em>, 137, 32-49. <a href="https://doi.org/10.1016/j.jmva.2015.01.020">[Link to JMVA]</a> <a href="http://arxiv.org/pdf/1408.0424.pdf">[Link to arXiv]</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#abstract-">Abstract.</a></li>
      <li><a href="#comparison-of-methods-">Comparison of Methods.</a></li>
      <li><a href="#posterior-summaries">Posterior Summaries</a></li>
      <li><a href="#demonstrate-equivariance">Demonstrate Equivariance</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by David Gerard, Peter Hoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>

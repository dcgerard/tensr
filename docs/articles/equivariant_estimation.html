<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equivariant Estimation of Kronecker Structured Covariance Matrices • tensr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Equivariant Estimation of Kronecker Structured Covariance Matrices">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tensr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/equivariant_estimation.html">Equivariant Estimation of Kronecker Structured Covariance Matrices</a>
    </li>
    <li>
      <a href="../articles/maximum_likelihood.html">Likelihood Inference in Kronecker Structured Covariance Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dcgerard/tensr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Equivariant Estimation of Kronecker Structured
Covariance Matrices</h1>
                        <h4 data-toc-skip class="author">David
Gerard</h4>
            
            <h4 data-toc-skip class="date">2025-07-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dcgerard/tensr/blob/HEAD/vignettes/equivariant_estimation.Rmd" class="external-link"><code>vignettes/equivariant_estimation.Rmd</code></a></small>
      <div class="hidden name"><code>equivariant_estimation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="abstract-">Abstract.<a class="anchor" aria-label="anchor" href="#abstract-"></a>
</h2>
<p>This Vignette demonstrates using the equivariant estimation
procedures in the <code>R</code> package <code>tensr</code>. We will
simulate some data then explore the performance differences between the
uniformly minimum risk equivariant estimator (UMREE), the maximum
likelihood estimator (MLE), multiway Takemura’s estimator, and a moment
based estimator. Then we will demonstrate extracting posterior
summaries. Finally, we will demonstrate the equivariance of the Bayes
rule.</p>
</div>
<div class="section level2">
<h2 id="comparison-of-methods-">Comparison of Methods.<a class="anchor" aria-label="anchor" href="#comparison-of-methods-"></a>
</h2>
<p>First, we generate a data array
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
of dimension
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mo>×</mo><mn>10</mn><mo>×</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">10 \times 10 \times 10</annotation></semantics></math>.
Each mode of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
will have an AR-1(0.7) covariance structure. That is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">cov</mtext><mo stretchy="false" form="prefix">(</mo><mtext mathvariant="normal">vec</mtext><mo stretchy="false" form="prefix">(</mo><mi>X</mi><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">)</mo><mo>=</mo><msub><mi mathvariant="normal">Σ</mi><mn>3</mn></msub><mo>⊗</mo><msub><mi mathvariant="normal">Σ</mi><mn>2</mn></msub><mo>⊗</mo><msub><mi mathvariant="normal">Σ</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\text{cov}(\text{vec}(X)) = \Sigma_3 \otimes \Sigma_2 \otimes \Sigma_1</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">vec</mtext><mo stretchy="false" form="prefix">(</mo><mi>⋅</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\text{vec}(\cdot)</annotation></semantics></math>
is the same think as <code>c</code> in <code>R</code> and just
“vectorizes”
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>,
and
“<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>⊗</mi><annotation encoding="application/x-tex">\otimes</annotation></semantics></math>”
is the Kronecker product. Hence
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Σ</mi><mrow><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><msup><mn>0.7</mn><mrow><mo stretchy="false" form="prefix">|</mo><mi>i</mi><mo>−</mo><mi>j</mi><mo stretchy="false" form="prefix">|</mo></mrow></msup></mrow><annotation encoding="application/x-tex">\Sigma_{i,j} = 0.7^{|i - j|}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">360</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>  <span class="co">#Dimension of tensor.</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="co">#Order of the tensor.</span></span>
<span></span>
<span><span class="va">cov_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">normalized_cov_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>  <span class="co">#Same as cov_list, but scaled down to determinant 1.</span></span>
<span><span class="va">sig2_total</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.7</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">mode_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cov_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">rho</span> <span class="op">^</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span>, <span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span>, <span class="st">"-"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">scale_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/det.html" class="external-link">det</a></span><span class="op">(</span><span class="va">cov_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">sig2_total</span> <span class="op">&lt;-</span> <span class="va">sig2_total</span> <span class="op">*</span> <span class="va">scale_cov</span></span>
<span>    <span class="va">normalized_cov_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">/</span> <span class="va">scale_cov</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##Generate data with above covariance structure.</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atrans.html">atrans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span>, dim <span class="op">=</span> <span class="va">p</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">cov_list</span>, <span class="va">mhalf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To get the UMREE, we first apply the function <code>equi_mcmc</code>.
This will give us posterior draws of the inverse of the lower-triangular
Cholesky square root of each component covariance matrix. This is with
respect to using the right Haar measure over a product group of
lower-triangular matrices as our prior. Using the output from
<code>equi_mcmc</code>, we apply the function
<code>get_equi_bayes</code> to obtain the Bayes rule under multiway
Stein’s loss.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equi_mcmc.html">equi_mcmc</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">1000</span><span class="op">)</span> </span>
<span><span class="va">bayes_rule</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_equi_bayes.html">get_equi_bayes</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">$</span><span class="va">Phi_inv</span>, <span class="va">mcmc_out</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">cov_umree</span> <span class="op">&lt;-</span> <span class="va">bayes_rule</span><span class="op">$</span><span class="va">Sig_hat</span></span>
<span><span class="co">#Estimate of the "standard deviation" form for the total variation parameter.</span></span>
<span><span class="va">sig_umree</span> <span class="op">&lt;-</span> <span class="va">bayes_rule</span><span class="op">$</span><span class="va">b</span> </span></code></pre></div>
<p>We can improve on the UMREE by calculating UMREEs for different
rotations of the data array, then “average” these UMREEs. The more
averagings the better in terms of statistical risk. This estimator is
called multiway Takemura’s estimator.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tak_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multiway_takemura.html">multiway_takemura</a></span><span class="op">(</span><span class="va">X</span>, ortho_max <span class="op">=</span> <span class="fl">3</span>, print_mcmc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Number of averagings =  1 </span></span>
<span><span class="co">## Number of averagings =  2 </span></span>
<span><span class="co">## Number of averagings =  3</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_takemura</span> <span class="op">&lt;-</span> <span class="va">tak_est</span><span class="op">$</span><span class="va">B</span></span>
<span><span class="va">sig_takemura</span> <span class="op">&lt;-</span> <span class="va">tak_est</span><span class="op">$</span><span class="va">b</span></span></code></pre></div>
<p>We use <code>holq</code> to obtain the MLE for comparison. The output
of <code>holq</code> is fed into <code>mle_from_holq</code> to obtain
the MLEs of each component covariance matrix.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">holq_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/holq.html">holq</a></span><span class="op">(</span><span class="va">X</span>, print_diff <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">mle_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mle_from_holq.html">mle_from_holq</a></span><span class="op">(</span><span class="va">holq_x</span><span class="op">)</span></span>
<span><span class="va">cov_mle</span> <span class="op">&lt;-</span> <span class="va">mle_x</span><span class="op">$</span><span class="va">cov_mle</span></span>
<span><span class="co">#The "standard deviation" form for the total variation parameter.</span></span>
<span><span class="va">sig_mle</span> <span class="op">&lt;-</span> <span class="va">mle_x</span><span class="op">$</span><span class="va">sig_mle</span> </span></code></pre></div>
<p>We also obtain a “moment-based” estimator for comparison. These are
just the sample covariance matrices of each mode, scaled down to have
unit determinant. The estimate of the total variation parameter is the
MLE conditional on the component covariance matrices. This is not
implemented in <code>tensr</code> because it performs poorly.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_moment</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>    <span class="va">cov_moment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">cov_chol_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>  <span class="co">## used for getting scale est</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">mode_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">cov_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mat.html">mat</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">mode_index</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/mat.html">mat</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">mode_index</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">cov_moment</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cov_temp</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/det.html" class="external-link">det</a></span><span class="op">(</span><span class="va">cov_temp</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">cov_chol_inv</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/backsolve.html" class="external-link">backsolve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">cov_moment</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">sig_moment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="../reference/atrans.html">atrans</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">cov_chol_inv</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cov_moment <span class="op">=</span> <span class="va">cov_moment</span>, sig_moment <span class="op">=</span> <span class="va">sig_moment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">moment_x</span> <span class="op">&lt;-</span> <span class="fu">get_moment</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">cov_moment</span> <span class="op">&lt;-</span> <span class="va">moment_x</span><span class="op">$</span><span class="va">cov_moment</span></span>
<span><span class="va">sig_moment</span> <span class="op">&lt;-</span> <span class="va">moment_x</span><span class="op">$</span><span class="va">sig_moment</span></span></code></pre></div>
<p>We can now compare the multiway Stein’s losses for each of the
estimators using <code>multi_stein_loss_cov</code>. The risk performance
should be, in decreasing order of performance, multiway Takemura’s
estimator, UMREE, MLE, moment. Of course, for any individual
realization, the loss ordering may be different.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">umree_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span><span class="op">(</span><span class="va">cov_umree</span>, <span class="va">normalized_cov_list</span>, <span class="va">sig_umree</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sig2_total</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tak_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span><span class="op">(</span><span class="va">cov_takemura</span>, <span class="va">normalized_cov_list</span>, <span class="va">sig_takemura</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sig2_total</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mle_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span><span class="op">(</span><span class="va">cov_mle</span>, <span class="va">normalized_cov_list</span>, <span class="va">sig_mle</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sig2_total</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">moment_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multi_stein_loss_cov.html">multi_stein_loss_cov</a></span><span class="op">(</span><span class="va">cov_moment</span>, <span class="va">normalized_cov_list</span>, <span class="va">sig_moment</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">sig2_total</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"Multiway Takemura's Loss:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tak_loss</span><span class="op">)</span>, <span class="st">"\n"</span>,</span>
<span>    <span class="st">"             UMREE Loss:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">umree_loss</span><span class="op">)</span>, <span class="st">"\n"</span>,  </span>
<span>    <span class="st">"               MLE Loss:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">mle_loss</span><span class="op">)</span>, <span class="st">"\n"</span>,</span>
<span>    <span class="st">"            Moment Loss:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">moment_loss</span><span class="op">)</span>, <span class="st">"\n"</span></span>
<span>   <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Multiway Takemura's Loss: 206 </span></span>
<span><span class="co">##               UMREE Loss: 209 </span></span>
<span><span class="co">##                 MLE Loss: 235 </span></span>
<span><span class="co">##              Moment Loss: 3631</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="posterior-summaries">Posterior Summaries<a class="anchor" aria-label="anchor" href="#posterior-summaries"></a>
</h2>
<p>You can also get the samples from the posterior if you want to
perform a fully Bayesian analysis. Just insert the output of
<code>equi_bayes</code> into <code>convert_cov</code> to get these
posterior samples.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_cov.html">convert_cov</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">)</span>   </span></code></pre></div>
<p><code>cov_post[[2]]</code> contains the posterior samples of the
total variation parameter. <code>cov_post[[1]][[i]][,,j]</code> contains
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>th
posterior sample of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>th
component covariance matrix. Here are some trace plots of the posterior
samples.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.axis <span class="op">=</span> <span class="fl">1</span>, cex.lab <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">1</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.4</span>,<span class="fl">2.6</span>,<span class="fl">2</span>,<span class="fl">0.2</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## trace plot of total variation parameter</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cov_post</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Iteration"</span>, main <span class="op">=</span> <span class="st">"Trace Plot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">sig2_total</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="st">"True Parameter"</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## some more trace plots</span></span>
<span><span class="va">random_trace</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cov_post</span>, <span class="va">true_cov</span>, <span class="va">p</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>    <span class="va">mode_look</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">x_look</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">[</span><span class="va">mode_look</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">y_look</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">p</span><span class="op">[</span><span class="va">mode_look</span><span class="op">]</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cov_post</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">mode_look</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">x_look</span>, <span class="va">y_look</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>         xlab <span class="op">=</span> <span class="st">"Iteration"</span>, </span>
<span>         ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">[</span><span class="fu">.</span><span class="op">(</span><span class="va">mode_look</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="st">"["</span><span class="op">]</span><span class="op">[</span><span class="fu">.</span><span class="op">(</span><span class="va">x_look</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="st">","</span><span class="op">]</span><span class="op">[</span><span class="fu">.</span><span class="op">(</span><span class="va">y_look</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="st">"]"</span><span class="op">]</span><span class="op">)</span>, </span>
<span>         main <span class="op">=</span> <span class="st">"Traceplot"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">true_cov</span><span class="op">[[</span><span class="va">mode_look</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">x_look</span>, <span class="va">y_look</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="st">"True Parameter"</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu">random_trace</span><span class="op">(</span><span class="va">cov_post</span>, <span class="va">normalized_cov_list</span>, <span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-2.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-3.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-4.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-9-5.png" width="700"></p>
<p>Here are the 95% posterior credible intervals of the covariance
parameters, sorted in lexicographical ordering of the row and column
indices.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.axis <span class="op">=</span> <span class="fl">1</span>, cex.lab <span class="op">=</span> <span class="fl">1</span>, cex.axis <span class="op">=</span> <span class="fl">1</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.4</span>,<span class="fl">2.6</span>,<span class="fl">2</span>,<span class="fl">0.2</span><span class="op">)</span>, mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">quantile_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">mode_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">quantile_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">cov_post</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, <span class="va">quantile</span>, </span>
<span>        probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>cex.main <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">mode_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">upper_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">quantile_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">3</span>, , <span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span>, </span>
<span>        diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">lower_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">quantile_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span>, </span>
<span>        diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">median_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">quantile_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>, , <span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span>, </span>
<span>        diag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">num_cred</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">num_cred</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lower_val</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">upper_val</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         xaxt <span class="op">=</span> <span class="st">"n"</span>, </span>
<span>         xlab <span class="op">=</span> <span class="st">"Parameter"</span>, ylab <span class="op">=</span> <span class="st">"Value"</span>,</span>
<span>         main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">z</span><span class="op">~</span><span class="op">~</span><span class="va">Sigma</span><span class="op">[</span><span class="va">y</span><span class="op">]</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="st">"Medians and 95% Credible Intervals for"</span>,</span>
<span>                                y <span class="op">=</span> <span class="va">mode_index</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_cred</span>, <span class="va">lower_val</span>, <span class="fl">1</span><span class="op">:</span><span class="va">num_cred</span>, <span class="va">upper_val</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_cred</span>, <span class="va">median_val</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">num_cred</span>, <span class="va">median_val</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">v_at</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">v_at</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-10-1.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-10-2.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-10-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="demonstrate-equivariance">Demonstrate Equivariance<a class="anchor" aria-label="anchor" href="#demonstrate-equivariance"></a>
</h2>
<p>We finish with a small example of how the UMREE is equivariant.
First, we generate a group element of a product group of lower
triangular matrices.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">mode_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">A_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span>, ncol <span class="op">=</span> <span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">A_temp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">A_temp</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">A_temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span>, shape <span class="op">=</span> <span class="fl">1</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">A_temp</span> <span class="op">&lt;-</span> <span class="va">A_temp</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">A_temp</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">A_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">A_temp</span></span>
<span><span class="op">}</span></span>
<span><span class="va">a_scale</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code></pre></div>
<p>Now we transform X.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_transformed</span> <span class="op">&lt;-</span> <span class="va">a_scale</span> <span class="op">*</span> <span class="fu"><a href="../reference/atrans.html">atrans</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">A_list</span><span class="op">)</span></span></code></pre></div>
<p>Now we get the UMREEs of the original and the transformed data.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equi_mcmc.html">equi_mcmc</a></span><span class="op">(</span><span class="va">X</span>, <span class="fl">10000</span><span class="op">)</span> </span>
<span><span class="va">bayes_rule</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_equi_bayes.html">get_equi_bayes</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">$</span><span class="va">Phi_inv</span>, <span class="va">mcmc_out</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">cov_x</span> <span class="op">&lt;-</span> <span class="va">bayes_rule</span><span class="op">$</span><span class="va">Sig_hat</span></span>
<span><span class="va">sig_x</span> <span class="op">&lt;-</span> <span class="va">bayes_rule</span><span class="op">$</span><span class="va">b</span> </span>
<span></span>
<span><span class="va">mcmc_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/equi_mcmc.html">equi_mcmc</a></span><span class="op">(</span><span class="va">X_transformed</span>, <span class="fl">10000</span><span class="op">)</span> </span>
<span><span class="va">bayes_rule</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_equi_bayes.html">get_equi_bayes</a></span><span class="op">(</span><span class="va">mcmc_out</span><span class="op">$</span><span class="va">Phi_inv</span>, <span class="va">mcmc_out</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span><span class="va">cov_x_t</span> <span class="op">&lt;-</span> <span class="va">bayes_rule</span><span class="op">$</span><span class="va">Sig_hat</span></span>
<span><span class="va">sig_x_t</span> <span class="op">&lt;-</span> <span class="va">bayes_rule</span><span class="op">$</span><span class="va">b</span></span></code></pre></div>
<p>The UMREE of transformed data should equal the transformed UMREE of
original data.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#These two quantities should be close.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"                Total Variation of transformed data:"</span>, <span class="va">sig_x_t</span>, <span class="st">"\n"</span>,</span>
<span>    <span class="st">"Transformation of total variation of original data:"</span>, <span class="va">sig_x</span> <span class="op">*</span> <span class="va">a_scale</span>,</span>
<span>    <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 Total Variation of transformed data: 3.906237 </span></span>
<span><span class="co">##  Transformation of total variation of original data: 3.905766</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">mode_index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>ask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">x_val</span> <span class="op">&lt;-</span> <span class="va">cov_x_t</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">y_val</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">A_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">cov_x</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A_list</span><span class="op">[[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="va">mode_index</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x_val</span>, <span class="va">y_val</span>, xlab <span class="op">=</span> <span class="st">"Transform of UMREE"</span>,</span>
<span>         ylab <span class="op">=</span> <span class="st">"UMREE of Transformed Data"</span>, </span>
<span>         main <span class="op">=</span> <span class="st">"Covariance Estimates"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">"(Should Lie on Line if Equivariant)"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="equivariant_estimation_files/figure-html/unnamed-chunk-14-1.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-14-2.png" width="700"><img src="equivariant_estimation_files/figure-html/unnamed-chunk-14-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p><strong>Gerard, D.</strong>, &amp; Hoff, P. (2015). Equivariant
minimax dominators of the MLE in the array normal model. <em>Journal of
Multivariate Analysis</em>, 137, 32-49. doi:
10.1016/j.jmva.2015.01.020</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Gerard, Peter Hoff.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
